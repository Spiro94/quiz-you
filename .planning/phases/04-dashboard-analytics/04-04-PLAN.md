---
phase: 04-dashboard-analytics
plan: 04
type: execute
wave: 3
depends_on: [04-02, 04-03]
files_modified:
  - src/lib/dashboard/aggregations.ts
  - src/hooks/useTopicAccuracy.ts
  - src/hooks/usePerformanceTrends.ts
  - src/components/dashboard/PerTopicAccuracy.tsx
  - src/components/dashboard/PerformanceTrends.tsx
  - src/components/dashboard/NextQuizRecommendation.tsx
  - src/pages/Dashboard.tsx
autonomous: false
requirements: [DASH-04, DASH-05, DASH-06]

must_haves:
  truths:
    - "Dashboard shows a per-topic accuracy chart (bar chart) with average score per topic across the last 20 sessions"
    - "Dashboard shows a performance trend line chart with average session score over time"
    - "Dashboard shows a 'Next Quiz' recommendation card with recommended topics and difficulty based on weak areas"
    - "Charts update when new session data is available (React Query cache invalidation)"
    - "Recharts renders line chart and bar chart correctly without TypeScript errors"
    - "Recommendation shows topics scoring below 70 as 'focus areas' and suggests appropriate difficulty"
  artifacts:
    - path: "src/lib/dashboard/aggregations.ts"
      provides: "getTopicAccuracy() and getPerformanceTrends() query functions"
      exports: ["getTopicAccuracy", "getPerformanceTrends", "TopicAccuracy", "TrendPoint"]
    - path: "src/hooks/useTopicAccuracy.ts"
      provides: "useTopicAccuracy() React Query hook"
      exports: ["useTopicAccuracy"]
    - path: "src/hooks/usePerformanceTrends.ts"
      provides: "usePerformanceTrends() React Query hook"
      exports: ["usePerformanceTrends"]
    - path: "src/components/dashboard/PerTopicAccuracy.tsx"
      provides: "Recharts BarChart of per-topic accuracy"
      min_lines: 50
    - path: "src/components/dashboard/PerformanceTrends.tsx"
      provides: "Recharts LineChart of session scores over time"
      min_lines: 50
    - path: "src/components/dashboard/NextQuizRecommendation.tsx"
      provides: "Recommendation card with weak topics + suggested difficulty"
      min_lines: 40
  key_links:
    - from: "src/hooks/useTopicAccuracy.ts"
      to: "src/lib/dashboard/aggregations.ts"
      via: "getTopicAccuracy() called inside useQuery queryFn"
      pattern: "getTopicAccuracy"
    - from: "src/components/dashboard/PerTopicAccuracy.tsx"
      to: "src/hooks/useTopicAccuracy.ts"
      via: "useTopicAccuracy() hook provides data to BarChart"
      pattern: "useTopicAccuracy"
    - from: "src/components/dashboard/PerformanceTrends.tsx"
      to: "src/hooks/usePerformanceTrends.ts"
      via: "usePerformanceTrends() hook provides data to LineChart"
      pattern: "usePerformanceTrends"
    - from: "src/components/dashboard/NextQuizRecommendation.tsx"
      to: "src/lib/dashboard/aggregations.ts"
      via: "weak topic identification using TopicAccuracy data"
      pattern: "TopicAccuracy"
---

<objective>
Install Recharts, implement aggregation query functions for topic accuracy and performance trends, build the three analytics components (PerTopicAccuracy bar chart, PerformanceTrends line chart, NextQuizRecommendation card), and integrate them into the Dashboard page alongside the existing session history list. End with a human verification checkpoint covering all Phase 4 requirements.

Purpose: Closes DASH-04, DASH-05, DASH-06 — the analytics layer that transforms raw session history into actionable insights. Users can see where they are weak, how they are trending, and what to practice next.
Output: Recharts-powered analytics section on the dashboard with recommendation card.
</objective>

<execution_context>
@/Users/danielvillamizar/.claude/get-shit-done/workflows/execute-plan.md
@/Users/danielvillamizar/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-dashboard-analytics/04-RESEARCH.md
@.planning/phases/04-dashboard-analytics/04-02-SUMMARY.md
@.planning/phases/04-dashboard-analytics/04-03-SUMMARY.md
@src/types/database.ts
@src/pages/Dashboard.tsx
@src/lib/dashboard/recommendations.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Recharts + aggregation queries + React Query hooks</name>
  <files>
    src/lib/dashboard/aggregations.ts
    src/hooks/useTopicAccuracy.ts
    src/hooks/usePerformanceTrends.ts
  </files>
  <action>
    **Install Recharts:**
    ```bash
    npm install recharts
    npm install --save-dev @types/recharts 2>/dev/null || true
    ```
    Note: Recharts ships its own TypeScript types — `@types/recharts` likely not needed and may not exist. If the `@types/recharts` install fails, that's expected; skip it.

    **Create src/lib/dashboard/aggregations.ts:**

    Two query functions:
    1. `getTopicAccuracy()`: fetches quiz_answers (score + status + session_id) for last 20 sessions, groups by topic from the matching quiz_questions. Uses client-side grouping for v1 (per RESEARCH.md recommendation: under 500 answers, in-memory is fine).
    2. `getPerformanceTrends()`: fetches session_summaries (created_at + final_score) ordered by date, returns time-series for line chart.

    Recommendation logic: topics with avgScore < 70 across last 20 sessions are "weak areas". The recommendation picks the weakest topics (up to 3) and suggests difficulty based on overall recent avg.

    ```typescript
    // src/lib/dashboard/aggregations.ts
    // Aggregation queries for analytics: topic accuracy and performance trends.
    // DASH-04: per-topic accuracy | DASH-05: performance trends | DASH-06: recommendation inputs
    import { supabase } from '../supabase'

    export interface TopicAccuracy {
      topic: string
      avgScore: number
      count: number
    }

    export interface TrendPoint {
      date: string       // ISO date string, formatted for chart X-axis
      avgScore: number
      sessionCount: number
    }

    export interface RecommendationResult {
      weakTopics: string[]
      suggestedDifficulty: 'beginner' | 'normal' | 'advanced'
      overallAvg: number
    }

    // getTopicAccuracy: fetch last 20 sessions' answers, join with questions for topic.
    // Groups in-memory: safe for v1 (< 500 rows).
    export async function getTopicAccuracy(userId: string): Promise<TopicAccuracy[]> {
      // Step 1: get IDs of last 20 sessions for this user
      const { data: recentSessions, error: sessionsError } = await supabase
        .from('session_summaries')
        .select('session_id')
        .eq('user_id', userId)
        .order('created_at', { ascending: false })
        .limit(20)

      if (sessionsError) throw new Error(`Failed to fetch recent sessions: ${sessionsError.message}`)
      if (!recentSessions || recentSessions.length === 0) return []

      const sessionIds = recentSessions.map(r => r.session_id)

      // Step 2: fetch answers + their question topics via join
      const { data: answers, error: answersError } = await supabase
        .from('quiz_answers')
        .select(`
          score,
          status,
          question_index,
          session_id,
          quiz_questions!inner ( topic )
        `)
        .in('session_id', sessionIds)
        .eq('status', 'completed')

      if (answersError) throw new Error(`Failed to fetch answers for accuracy: ${answersError.message}`)
      if (!answers || answers.length === 0) return []

      // Step 3: group by topic in memory
      const byTopic = new Map<string, { sum: number; count: number }>()

      answers.forEach(a => {
        const topic = (a.quiz_questions as { topic: string } | null)?.topic ?? 'Unknown'
        const current = byTopic.get(topic) ?? { sum: 0, count: 0 }
        byTopic.set(topic, {
          sum: current.sum + (a.score ?? 0),
          count: current.count + 1
        })
      })

      return Array.from(byTopic.entries())
        .map(([topic, { sum, count }]) => ({
          topic,
          avgScore: Math.round(sum / count),
          count
        }))
        .sort((a, b) => a.avgScore - b.avgScore)  // Weakest first for easy scanning
    }

    // getPerformanceTrends: time-series of session avg scores for line chart.
    // Returns up to 30 most recent sessions ordered by date ascending (oldest left → newest right).
    export async function getPerformanceTrends(userId: string): Promise<TrendPoint[]> {
      const { data, error } = await supabase
        .from('session_summaries')
        .select('created_at, final_score')
        .eq('user_id', userId)
        .order('created_at', { ascending: false })
        .limit(30)

      if (error) throw new Error(`Failed to fetch performance trends: ${error.message}`)
      if (!data || data.length === 0) return []

      // Reverse to get chronological order (oldest first) for chart X-axis
      return [...data].reverse().map(row => ({
        date: row.created_at,
        avgScore: row.final_score,
        sessionCount: 1
      }))
    }

    // computeRecommendation: derive next-quiz suggestion from topic accuracy + recent trend.
    // Uses simple thresholds: weak = avgScore < 70, difficulty from overall avg.
    export function computeRecommendation(
      topicAccuracy: TopicAccuracy[],
      recentSessionAvg: number,
      currentDifficulty: 'beginner' | 'normal' | 'advanced' = 'normal'
    ): RecommendationResult {
      const weakTopics = topicAccuracy
        .filter(t => t.avgScore < 70)
        .slice(0, 3)
        .map(t => t.topic)

      let suggestedDifficulty: 'beginner' | 'normal' | 'advanced' = currentDifficulty
      if (recentSessionAvg >= 85) {
        if (currentDifficulty === 'beginner') suggestedDifficulty = 'normal'
        else if (currentDifficulty === 'normal') suggestedDifficulty = 'advanced'
      } else if (recentSessionAvg < 50) {
        if (currentDifficulty === 'advanced') suggestedDifficulty = 'normal'
        else if (currentDifficulty === 'normal') suggestedDifficulty = 'beginner'
      }

      return {
        weakTopics,
        suggestedDifficulty,
        overallAvg: recentSessionAvg
      }
    }
    ```

    **Create src/hooks/useTopicAccuracy.ts:**

    ```typescript
    // src/hooks/useTopicAccuracy.ts
    import { useQuery } from '@tanstack/react-query'
    import { useAuth } from '../context/AuthContext'
    import { getTopicAccuracy } from '../lib/dashboard/aggregations'

    export function useTopicAccuracy() {
      const { user } = useAuth()

      return useQuery({
        queryKey: ['topic-accuracy', user?.id],
        queryFn: () => getTopicAccuracy(user!.id),
        enabled: !!user?.id,
        staleTime: 10 * 60 * 1000  // 10 minutes
      })
    }
    ```

    **Create src/hooks/usePerformanceTrends.ts:**

    ```typescript
    // src/hooks/usePerformanceTrends.ts
    import { useQuery } from '@tanstack/react-query'
    import { useAuth } from '../context/AuthContext'
    import { getPerformanceTrends } from '../lib/dashboard/aggregations'

    export function usePerformanceTrends() {
      const { user } = useAuth()

      return useQuery({
        queryKey: ['performance-trends', user?.id],
        queryFn: () => getPerformanceTrends(user!.id),
        enabled: !!user?.id,
        staleTime: 10 * 60 * 1000  // 10 minutes
      })
    }
    ```
  </action>
  <verify>
    Run: `npm install recharts` succeeds.
    Run: `npx tsc -p tsconfig.app.json --noEmit` — 0 errors.
    Check: `node_modules/recharts` directory exists.
    Check: `src/lib/dashboard/aggregations.ts` exports `getTopicAccuracy`, `getPerformanceTrends`, `computeRecommendation`, `TopicAccuracy`, `TrendPoint`.
    Check: `src/hooks/useTopicAccuracy.ts` and `src/hooks/usePerformanceTrends.ts` exist with useQuery.
  </verify>
  <done>
    Recharts installed. TypeScript compiles clean. Aggregation functions implemented with client-side grouping for topic accuracy. Performance trends query returns chronological time-series. React Query hooks wrap both functions.
  </done>
</task>

<task type="auto">
  <name>Task 2: Analytics components + Dashboard page integration</name>
  <files>
    src/components/dashboard/PerTopicAccuracy.tsx
    src/components/dashboard/PerformanceTrends.tsx
    src/components/dashboard/NextQuizRecommendation.tsx
    src/pages/Dashboard.tsx
  </files>
  <action>
    **Create src/components/dashboard/PerTopicAccuracy.tsx:**

    Recharts BarChart — horizontal bars work better than vertical for topic names (long strings). Each bar colored using getScoreColor thresholds. Wrap in `<div role="img" aria-label="...">` for accessibility.

    ```typescript
    // src/components/dashboard/PerTopicAccuracy.tsx
    // DASH-04: per-topic accuracy bar chart using Recharts.
    import {
      BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip,
      ResponsiveContainer, Cell
    } from 'recharts'
    import { useTopicAccuracy } from '../../hooks/useTopicAccuracy'

    function scoreToColor(score: number): string {
      if (score >= 85) return '#16a34a'  // green-600
      if (score >= 70) return '#2563eb'  // blue-600
      if (score >= 50) return '#ca8a04'  // yellow-600
      return '#dc2626'                   // red-600
    }

    export function PerTopicAccuracy() {
      const { data: topics = [], isLoading } = useTopicAccuracy()

      if (isLoading) {
        return <div className="h-64 bg-gray-100 rounded-lg animate-pulse" />
      }

      if (topics.length === 0) {
        return (
          <div className="bg-white rounded-lg border border-gray-200 p-6 text-center">
            <p className="text-gray-400 text-sm">Complete a quiz to see topic accuracy.</p>
          </div>
        )
      }

      return (
        <div className="bg-white rounded-lg border border-gray-200 p-6">
          <h2 className="text-base font-semibold text-gray-800 mb-4">Accuracy by Topic</h2>
          <div
            role="img"
            aria-label="Bar chart showing average score per topic"
          >
            <ResponsiveContainer width="100%" height={Math.max(200, topics.length * 40)}>
              <BarChart
                data={topics}
                layout="vertical"
                margin={{ top: 0, right: 20, left: 0, bottom: 0 }}
              >
                <CartesianGrid strokeDasharray="3 3" horizontal={false} />
                <XAxis type="number" domain={[0, 100]} tickFormatter={v => `${v}`} />
                <YAxis
                  type="category"
                  dataKey="topic"
                  width={100}
                  tick={{ fontSize: 12 }}
                />
                <Tooltip
                  formatter={(value: number, _name: string, props) => [
                    `${value} avg (${props.payload.count} questions)`,
                    'Score'
                  ]}
                />
                <Bar dataKey="avgScore" radius={[0, 4, 4, 0]}>
                  {topics.map((entry, index) => (
                    <Cell key={index} fill={scoreToColor(entry.avgScore)} />
                  ))}
                </Bar>
              </BarChart>
            </ResponsiveContainer>
          </div>
        </div>
      )
    }
    ```

    **Create src/components/dashboard/PerformanceTrends.tsx:**

    Recharts LineChart — session scores over time. X-axis: date formatted as "MMM d" using date-fns. Y-axis: 0-100. Line colored blue (consistent with Phase 3 score tier colors).

    ```typescript
    // src/components/dashboard/PerformanceTrends.tsx
    // DASH-05: session score trend over time using Recharts LineChart.
    import {
      LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip,
      ResponsiveContainer
    } from 'recharts'
    import { format } from 'date-fns'
    import { usePerformanceTrends } from '../../hooks/usePerformanceTrends'

    export function PerformanceTrends() {
      const { data: trends = [], isLoading } = usePerformanceTrends()

      if (isLoading) {
        return <div className="h-64 bg-gray-100 rounded-lg animate-pulse" />
      }

      if (trends.length === 0) {
        return (
          <div className="bg-white rounded-lg border border-gray-200 p-6 text-center">
            <p className="text-gray-400 text-sm">Complete sessions to see your progress over time.</p>
          </div>
        )
      }

      return (
        <div className="bg-white rounded-lg border border-gray-200 p-6">
          <h2 className="text-base font-semibold text-gray-800 mb-4">Performance Over Time</h2>
          <div
            role="img"
            aria-label="Line chart showing quiz score trend over time"
          >
            <ResponsiveContainer width="100%" height={260}>
              <LineChart
                data={trends}
                margin={{ top: 5, right: 20, left: 0, bottom: 5 }}
              >
                <CartesianGrid strokeDasharray="3 3" />
                <XAxis
                  dataKey="date"
                  tickFormatter={d => {
                    try { return format(new Date(d), 'MMM d') }
                    catch { return '' }
                  }}
                  tick={{ fontSize: 11 }}
                />
                <YAxis domain={[0, 100]} tick={{ fontSize: 11 }} />
                <Tooltip
                  labelFormatter={label => {
                    try { return format(new Date(label as string), 'MMM d, yyyy') }
                    catch { return label as string }
                  }}
                  formatter={(value: number) => [`${value}`, 'Score']}
                />
                <Line
                  type="monotone"
                  dataKey="avgScore"
                  stroke="#2563eb"
                  strokeWidth={2}
                  dot={{ fill: '#2563eb', r: 3 }}
                  activeDot={{ r: 5 }}
                />
              </LineChart>
            </ResponsiveContainer>
          </div>
        </div>
      )
    }
    ```

    **Create src/components/dashboard/NextQuizRecommendation.tsx:**

    Recommendation card. Uses `useTopicAccuracy` and `usePerformanceTrends` hooks (already cached by React Query from other components). Calls `computeRecommendation()`. Shows: weak focus topics (or "Keep it up!" if no weak topics), suggested difficulty, and a "Start Recommended Quiz" link to `/quiz/setup` (pre-filling not required in v1 — user navigates to setup form).

    ```typescript
    // src/components/dashboard/NextQuizRecommendation.tsx
    // DASH-06: next quiz recommendation based on weak areas and recent performance.
    import { Link } from 'react-router-dom'
    import { useTopicAccuracy } from '../../hooks/useTopicAccuracy'
    import { usePerformanceTrends } from '../../hooks/usePerformanceTrends'
    import { computeRecommendation } from '../../lib/dashboard/aggregations'

    const DIFFICULTY_LABELS: Record<string, string> = {
      beginner: 'Beginner',
      normal: 'Intermediate',
      advanced: 'Advanced'
    }

    export function NextQuizRecommendation() {
      const { data: topics = [], isLoading: topicsLoading } = useTopicAccuracy()
      const { data: trends = [], isLoading: trendsLoading } = usePerformanceTrends()

      if (topicsLoading || trendsLoading) {
        return <div className="h-36 bg-gray-100 rounded-lg animate-pulse" />
      }

      if (topics.length === 0) {
        return null  // No data yet — don't show recommendation
      }

      // Compute overall recent avg from trends (last 5 sessions)
      const recentTrends = trends.slice(-5)
      const recentAvg =
        recentTrends.length > 0
          ? Math.round(recentTrends.reduce((sum, t) => sum + t.avgScore, 0) / recentTrends.length)
          : 0

      // Determine current difficulty from most recent session's trend data
      // (We don't have difficulty in trend data — default to 'normal' for recommendation)
      const recommendation = computeRecommendation(topics, recentAvg, 'normal')

      const hasWeakAreas = recommendation.weakTopics.length > 0

      return (
        <div className="bg-blue-50 border border-blue-100 rounded-lg p-5">
          <h2 className="text-base font-semibold text-blue-900 mb-1">Recommended Next Quiz</h2>

          <div className="mt-3 space-y-2">
            <div>
              <p className="text-xs font-medium text-blue-700 uppercase tracking-wide">Suggested Difficulty</p>
              <p className="text-blue-800 font-semibold">
                {DIFFICULTY_LABELS[recommendation.suggestedDifficulty]}
              </p>
            </div>

            {hasWeakAreas ? (
              <div>
                <p className="text-xs font-medium text-blue-700 uppercase tracking-wide">Focus Areas</p>
                <p className="text-blue-800">
                  {recommendation.weakTopics.join(', ')}
                </p>
                <p className="text-xs text-blue-600 mt-0.5">
                  These topics scored below 70 in recent sessions.
                </p>
              </div>
            ) : (
              <p className="text-blue-700 text-sm">
                You&apos;re doing great across all topics! Keep it up.
              </p>
            )}
          </div>

          <Link
            to="/quiz/setup"
            className="mt-4 inline-block w-full text-center bg-blue-600 hover:bg-blue-700 text-white text-sm font-semibold py-2 rounded-lg transition-colors"
          >
            Start a Quiz
          </Link>
        </div>
      )
    }
    ```

    **Update src/pages/Dashboard.tsx:**

    Add the analytics section below the session history list. Import and render the three new analytics components. Layout: full-width recommendation card first, then two-column grid (topic accuracy | trends) on large screens, single column on mobile.

    Add to the existing Dashboard.tsx (preserve existing useSessions, FilterBar, SessionHistoryList):

    ```typescript
    // Add imports at the top:
    import { PerTopicAccuracy } from '../components/dashboard/PerTopicAccuracy'
    import { PerformanceTrends } from '../components/dashboard/PerformanceTrends'
    import { NextQuizRecommendation } from '../components/dashboard/NextQuizRecommendation'

    // Add inside <main> after the SessionHistoryList section:
    {/* Analytics section */}
    <div className="space-y-4 pt-4 border-t border-gray-200">
      <h2 className="text-lg font-bold text-gray-900">Analytics</h2>
      <NextQuizRecommendation />
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-4">
        <PerTopicAccuracy />
        <PerformanceTrends />
      </div>
    </div>
    ```

    The full Dashboard page after update will render:
    1. DashboardHeader
    2. "Your Sessions" heading + "New Quiz" button
    3. FilterBar
    4. SessionHistoryList (with pagination)
    5. Analytics section: NextQuizRecommendation + PerTopicAccuracy + PerformanceTrends
  </action>
  <verify>
    Run: `npx tsc -p tsconfig.app.json --noEmit` — 0 errors.
    Check: `src/components/dashboard/PerTopicAccuracy.tsx` imports from `recharts`.
    Check: `src/components/dashboard/PerformanceTrends.tsx` imports from `recharts` and `date-fns`.
    Check: `src/components/dashboard/NextQuizRecommendation.tsx` imports `computeRecommendation`.
    Check: `src/pages/Dashboard.tsx` imports all three analytics components.
    Check: Recharts components use `ResponsiveContainer` (responsive width).
  </verify>
  <done>
    TypeScript compiles clean. Analytics components implemented with Recharts. Dashboard page renders topic accuracy bar chart, performance trend line chart, and recommendation card. All three analytics components load data via React Query (shared cache with other hooks).
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Human verification — all Phase 4 requirements</name>
  <what-built>
    Complete Phase 4: Dashboard & Analytics implementation including:
    - 04-01: session_summaries table, computeSessionSummary(), SessionSummaryPage (COMP-02, COMP-03, COMP-04, COMP-05)
    - 04-02: Dashboard session history list with FilterBar and pagination (DASH-01, DASH-02, DASH-07)
    - 04-03: Session detail view with all Q/A/feedback (DASH-03)
    - 04-04: Analytics — per-topic accuracy chart, performance trend chart, next-quiz recommendation (DASH-04, DASH-05, DASH-06)
  </what-built>
  <how-to-verify>
    Start the dev server: `npm run dev`

    **1. Session Summary (COMP-02, COMP-03, COMP-04, COMP-05)**
    - Complete a full quiz session (or use a previously completed session)
    - Confirm you land on `/session/:sessionId/summary` after the last question (not /dashboard)
    - Confirm: final score (0-100) displayed prominently
    - Confirm: topic breakdown table shows average score per topic
    - Confirm: recommended difficulty shown (should change based on score: >=85 upgrades, <50 downgrades)
    - Click "Back to Dashboard" → confirms navigation to /dashboard

    **2. Dashboard Session History (DASH-01, DASH-02)**
    - Navigate to /dashboard
    - Confirm: session list shows past sessions with date, topics, score (color-coded), duration
    - Confirm: sessions ordered newest first
    - Confirm: session rows show "Details" link alongside score

    **3. Filtering (DASH-07)**
    - Select a topic in FilterBar → confirm list updates (shows only sessions with that topic, or empty state if none)
    - Set a date range → confirm list filters by date
    - Click "Clear filters" → confirm all sessions return
    - Navigate to page 2 then press browser back → confirm browser back restores correct page (URL param persists)

    **4. Session Detail (DASH-03)**
    - Click "Details" on any past session row
    - Confirm: all questions displayed with body text
    - Confirm: each answered question shows user answer, score (color-coded), feedback, model answer
    - Confirm: skipped questions show "Skipped" badge with no feedback section
    - Click "Back to Dashboard" → confirms navigation

    **5. Analytics (DASH-04, DASH-05, DASH-06)**
    - Scroll to Analytics section on /dashboard
    - Confirm: "Accuracy by Topic" bar chart renders with bars color-coded by score tier
    - Confirm: "Performance Over Time" line chart renders with dates on X-axis and scores on Y-axis
    - Confirm: "Recommended Next Quiz" card shows either weak focus topics or "Keep it up!"
    - If only one session: charts still render without crashing (single-point line chart is acceptable)

    **6. TypeScript + Build (regression check)**
    Run: `npx tsc -p tsconfig.app.json --noEmit` → must output 0 errors
    Run: `npm run build` → must succeed without errors
  </how-to-verify>
  <resume-signal>Type "approved" if all checks pass, or describe any issues to fix</resume-signal>
  <action>Human verifies all Phase 4 requirements in the browser using the steps in how-to-verify above. No code changes by Claude unless issues are reported.</action>
  <verify>All 6 verification sections above pass as described in how-to-verify.</verify>
  <done>All 11 Phase 4 requirements (COMP-02, COMP-03, COMP-04, COMP-05, DASH-01 through DASH-07) confirmed working in live browser. Build passes.</done>
</task>

</tasks>

<verification>
1. `npx tsc -p tsconfig.app.json --noEmit` → 0 errors
2. `npm run build` → succeeds
3. All 11 Phase 4 requirements verified in browser: COMP-02, COMP-03, COMP-04, COMP-05, DASH-01, DASH-02, DASH-03, DASH-04, DASH-05, DASH-06, DASH-07
4. Recharts bar chart and line chart render correctly
5. Session summary appears after quiz completion (not /dashboard directly)
6. Session detail shows all Q/A with feedback
7. Filters update session list from server (not client-side)
8. Recommendation card shows correct weak topics and difficulty suggestion
</verification>

<success_criteria>
- All 11 Phase 4 requirements verified live in browser
- PerTopicAccuracy: bar chart renders, bars color-coded by score tier
- PerformanceTrends: line chart renders with date axis and score Y-axis
- NextQuizRecommendation: shows weak topics (avgScore < 70) and suggested difficulty
- Session summary page renders after quiz completion with score + topic breakdown + recommendation
- Dashboard session list renders real data with filtering and pagination
- Session detail page shows all questions with answers, scores, feedback
- TypeScript compiles and production build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/04-dashboard-analytics/04-04-SUMMARY.md`
</output>
