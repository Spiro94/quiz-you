---
phase: 05-ui-redesign-with-quiz-you-pen
plan: 02
type: execute
wave: 2
depends_on:
  - 05-01
files_modified:
  - src/pages/QuizSetup.tsx
  - src/pages/QuizSession.tsx
  - src/components/quiz/QuizSetupForm.tsx
  - src/components/quiz/QuestionDisplay.tsx
  - src/components/quiz/AnswerInput.tsx
  - src/components/quiz/ProgressIndicator.tsx
  - src/components/quiz/EvaluationResult.tsx
  - src/components/quiz/TopicBadge.tsx
autonomous: false
requirements:
  - UI-REDESIGN-QUIZ
must_haves:
  truths:
    - "QuizSetup page and form use dark background and surface card with token-based classes"
    - "Topic checkboxes use subtle bg-elevated, active state uses bg-primary-muted with primary border"
    - "QuestionDisplay badges (type, topic, difficulty) use design system badge tokens: primary-muted/primary, success-muted/success, warning-muted/warning"
    - "AnswerInput textarea uses bg-elevated with border-border; Monaco editor uses vs-dark theme matching code-bg token"
    - "EvaluationResult score color tiers use design system tokens (success, accent, warning, error) not hardcoded hex"
    - "ProgressIndicator progress bar uses bg-primary fill on bg-subtle track"
    - "TopicBadge uses primary-muted background with primary text matching design system Chip component"
    - "QuizSession page wrapper and loading states use bg-background and surface-based cards"
    - "No regression in quiz functionality: generation, display, submission, evaluation, skip all work"
  artifacts:
    - path: "src/components/quiz/QuestionDisplay.tsx"
      provides: "Dark mode question rendering with token-based badges and prose styling for code blocks using code-bg"
    - path: "src/components/quiz/AnswerInput.tsx"
      provides: "Dark mode textarea + Monaco editor (vs-dark theme) with token-based submit/skip buttons"
    - path: "src/components/quiz/EvaluationResult.tsx"
      provides: "Dark mode evaluation card with score tiers using design token colors and feedback/model answer sections"
    - path: "src/components/quiz/ProgressIndicator.tsx"
      provides: "Dark progress bar using bg-primary fill on bg-subtle track"
    - path: "src/components/quiz/TopicBadge.tsx"
      provides: "Dark chip: bg-primary-muted text-primary border-primary"
  key_links:
    - from: "src/components/quiz/AnswerInput.tsx"
      to: "onSubmit prop"
      via: "handleSubmit calls onSubmit(code|text) — submission logic untouched"
      pattern: "onSubmit\\("
    - from: "src/components/quiz/EvaluationResult.tsx"
      to: "onNext prop"
      via: "onClick calls onNext() — navigation logic untouched"
      pattern: "onNext\\("
---

<objective>
Apply quiz-you.pen design tokens to all quiz flow components (QuizSetup, QuizSession, QuestionDisplay, AnswerInput, ProgressIndicator, EvaluationResult, TopicBadge, QuizSetupForm).

Purpose: The quiz flow is the core user experience — question display, answer input, and evaluation feedback all need consistent dark mode treatment. This plan refactors 8 files while preserving all quiz generation, evaluation, and skip logic.

Output: All quiz flow components restyled to dark mode using design system tokens from 05-01.
</objective>

<execution_context>
@/Users/danielvillamizar/.claude/get-shit-done/workflows/execute-plan.md
@/Users/danielvillamizar/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-ui-redesign-with-quiz-you-pen/05-RESEARCH.md
@.planning/phases/05-ui-redesign-with-quiz-you-pen/05-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Restyle QuizSetup page, QuizSetupForm, and QuizSession page wrapper</name>
  <files>
    src/pages/QuizSetup.tsx
    src/pages/QuizSession.tsx
    src/components/quiz/QuizSetupForm.tsx
  </files>
  <action>
    Apply design tokens to quiz setup and session page wrappers. DO NOT change any form logic, validation, session creation, or navigation.

    **src/pages/QuizSetup.tsx:**
    - Root div: "min-h-screen bg-background" (was bg-gray-50)
    - Inner container div: "mx-auto max-w-2xl px-4 py-12" (no change)
    - h1: "text-2xl font-bold text-foreground" (was text-gray-900)
    - Subtitle p: "mt-1 text-sm text-muted-foreground" (was text-gray-500)
    - Form card div: "rounded-lg bg-surface border border-border p-6" (was bg-white shadow-sm border-gray-200)

    **src/pages/QuizSession.tsx:**
    Find all loading/error state wrappers:
    - Loading screen: "min-h-screen bg-background flex items-center justify-center" (was bg-gray-50)
    - Loading text: "text-muted-foreground" (was text-gray-500)
    - Error screen: same dark bg-background wrapper
    - Error text: "text-error" (was text-red-600)
    - Error back link: "text-accent underline text-sm" (was text-blue-600)
    - Main session container (the outermost div): "min-h-screen bg-background" (was bg-gray-50 or similar)
    - Session card/content area: "max-w-2xl mx-auto px-4 py-8 space-y-6" (keep structure, remove light bg)
    - Any white bg-white card wrapping session content → bg-surface border border-border rounded-lg p-6
    - Any text-gray-* headings → text-foreground or text-muted-foreground
    - Skip button (if present inline, not in AnswerInput): "text-sm text-muted-foreground hover:text-foreground underline transition" (was text-gray-500)
    - "Generating question..." or loading spinner text: text-muted-foreground
    - Any gray dividers (border-gray-200): border-border

    **src/components/quiz/QuizSetupForm.tsx:**
    - Form errors at top: "rounded-md bg-error-muted border border-error p-4" + "text-sm text-error" (was bg-red-50 border-red-200 text-red-700)
    - fieldset legend (topics, difficulty, types, count): "text-sm font-semibold text-foreground mb-3" (was text-gray-900)
    - Required asterisk: "text-error" (was text-red-500)
    - Topic checkbox labels: "flex items-center gap-2 rounded-md border border-border px-3 py-2 text-sm cursor-pointer bg-elevated text-foreground hover:bg-subtle has-[:checked]:bg-primary-muted has-[:checked]:border-primary" (was bg-white hover:bg-gray-50 has-[:checked]:bg-blue-50 has-[:checked]:border-blue-300)
    - Checkbox inputs: "rounded border-border text-primary focus:ring-primary" (was border-gray-300 text-blue-600 focus:ring-blue-500)
    - Validation error messages under fields: "mt-2 text-sm text-error" (was text-red-600)
    - Radio button labels (difficulty, question types): same dark treatment as topic labels — bg-elevated, hover:bg-subtle, has-[:checked]:bg-primary-muted, has-[:checked]:border-primary
    - Select inputs (question count if select element): "bg-elevated border border-border rounded-lg text-foreground px-3 py-2 focus:ring-2 focus:ring-primary outline-none"
    - Submit button: "w-full py-3 bg-primary text-white font-semibold rounded-lg hover:bg-primary-hover disabled:opacity-50 disabled:cursor-not-allowed transition" (was bg-indigo-600 or bg-blue-600)
    - Section dividers between fieldsets: "border-t border-border pt-6" (was border-gray-200)
    - Helper/hint text: "text-muted-foreground" (was text-gray-500)
  </action>
  <verify>
    Run: npm run build
    Must pass without TypeScript errors.

    Run: npm run dev and visit http://localhost:5173/quiz/setup (requires login)
    1. Page background dark, form card has dark surface with visible border
    2. Topic checkboxes show dark elevated bg; checked state shows purple-muted background with purple border
    3. Submit button is purple
    4. Form validation still works: submitting without selecting topics shows red error text
  </verify>
  <done>
    - QuizSetup page and form use design system dark tokens throughout
    - Form validation and submission functionality unchanged
    - No hardcoded gray/indigo/blue Tailwind classes remain in these 3 files
    - npm run build passes
  </done>
</task>

<task type="auto">
  <name>Task 2: Restyle quiz display components (QuestionDisplay, AnswerInput, ProgressIndicator, EvaluationResult, TopicBadge)</name>
  <files>
    src/components/quiz/QuestionDisplay.tsx
    src/components/quiz/AnswerInput.tsx
    src/components/quiz/ProgressIndicator.tsx
    src/components/quiz/EvaluationResult.tsx
    src/components/quiz/TopicBadge.tsx
  </files>
  <action>
    Restyle the core quiz display and interaction components. DO NOT change markdown rendering, Monaco integration, evaluation logic, or prop interfaces.

    **src/components/quiz/ProgressIndicator.tsx:**
    - "Question X of Y" span: "text-sm font-medium text-foreground" (was text-gray-700)
    - "X% complete" span: "text-xs text-muted-foreground" (was text-gray-500)
    - Progress track div: "h-1.5 w-full overflow-hidden rounded-full bg-subtle" (was bg-gray-200)
    - Progress fill div: "h-full rounded-full bg-primary transition-all duration-300" (was bg-blue-600)

    **src/components/quiz/TopicBadge.tsx:**
    - span: "inline-flex items-center rounded-full bg-primary-muted border border-primary px-2.5 py-0.5 text-xs font-medium text-primary" (was bg-blue-50 border-blue-200 text-blue-700)

    **src/components/quiz/QuestionDisplay.tsx:**
    - Remove the typeBadgeClass conditional variable. Replace with:
      - Coding badge: "bg-primary-muted border border-primary text-primary"
      - Theoretical badge: "bg-success-muted border border-success text-success"
    - Both badge spans keep: "inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-medium"
    - Topic badge (gray-100 pill): "inline-flex items-center rounded-full bg-subtle border border-border px-2.5 py-0.5 text-xs font-medium text-muted-foreground"
    - Difficulty badge (amber): "inline-flex items-center rounded-full bg-warning-muted border border-warning px-2.5 py-0.5 text-xs font-medium text-warning capitalize"
    - h2 question title: "text-lg font-semibold text-foreground leading-snug" (was text-gray-900)
    - Prose div for markdown body: "prose prose-sm max-w-none text-muted-foreground prose-code:bg-code-bg prose-code:rounded prose-code:px-1.5 prose-code:py-0.5 prose-code:text-primary prose-code:font-mono prose-pre:bg-code-bg prose-pre:text-foreground prose-pre:border prose-pre:border-code-border prose-pre:p-4 prose-pre:rounded-lg prose-pre:overflow-x-auto prose-pre:text-sm [&_pre]:whitespace-pre-wrap [&_code]:break-words"
      (changed: text-gray-700 → text-muted-foreground; prose-code:bg-gray-100 → prose-code:bg-code-bg; prose-pre:bg-gray-900 → prose-pre:bg-code-bg; added prose-pre:border prose-pre:border-code-border; prose-code:text-purple-700 → prose-code:text-primary; prose-pre:text-gray-100 → prose-pre:text-foreground)
    - Expected format hint p: "text-xs text-muted-foreground italic" (was text-gray-500)

    **src/components/quiz/AnswerInput.tsx:**
    - Textarea (theoretical): "w-full rounded-lg border border-border bg-elevated text-foreground placeholder:text-placeholder p-4 font-mono text-sm resize-none focus:ring-2 focus:ring-primary focus:border-primary outline-none transition min-h-[200px]"
      (was something like border-gray-300 bg-white or similar)
    - Monaco editor wrapper div: "rounded-md overflow-hidden border border-code-border"
      (was border-gray-300)
    - Monaco Suspense fallback div: "h-64 flex items-center justify-center bg-code-bg text-muted-foreground text-sm"
      (was bg-gray-900 text-gray-400)
    - Monaco editor component: add prop theme="vs-dark" to align with code-bg token (#111118 ≈ vs-dark)
    - Submit button: "flex-1 rounded-md bg-primary px-4 py-2.5 text-sm font-semibold text-white hover:bg-primary-hover focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 focus:ring-offset-background disabled:opacity-50 disabled:cursor-not-allowed transition"
      (was bg-blue-600 hover:bg-blue-500 focus:ring-blue-500 or similar)
    - Skip button: "flex-1 rounded-md bg-subtle border border-border px-4 py-2.5 text-sm font-medium text-muted-foreground hover:text-foreground hover:bg-elevated focus:outline-none focus:ring-2 focus:ring-border transition"
      (was a ghost/secondary style)
    - Button row wrapper (Submit + Skip): "flex gap-3" (keep as-is if already flex)
    - Character count or hint text (if any): text-muted-foreground text-xs

    **src/components/quiz/EvaluationResult.tsx:**
    Update getScoreColor() to return token-based Tailwind classes instead of hardcoded Tailwind color classes:
    ```typescript
    function getScoreColor(score: number): string {
      if (score >= 85) return 'text-success'
      if (score >= 70) return 'text-accent'
      if (score >= 50) return 'text-warning'
      return 'text-error'
    }
    ```
    (was: text-green-600, text-blue-600, text-yellow-600, text-red-600)

    Score display:
    - "out of 100" div: "text-sm text-muted-foreground mt-1" (was text-gray-500)
    - Score label div: keep getScoreColor(evaluation.score) class, add "text-base font-medium mt-2"

    Feedback section:
    - Outer div: "rounded-lg border-l-4 border-primary bg-primary-muted p-4" (was border-blue-500 bg-blue-50)
    - "Feedback" h3: "text-sm font-semibold text-foreground mb-2" (was text-blue-900)
    - Feedback prose div: "prose prose-sm max-w-none text-foreground prose-code:bg-code-bg prose-pre:overflow-x-auto" (was text-blue-800 prose-code:bg-blue-100)

    Model Answer section:
    - Outer div: "rounded-lg border-l-4 border-success bg-success-muted p-4" (was border-green-500 bg-green-50)
    - "Model Answer" h3: "text-sm font-semibold text-foreground mb-2" (was text-green-900)
    - Model answer prose div: "prose prose-sm max-w-none text-foreground prose-code:bg-code-bg prose-pre:overflow-x-auto [&_pre]:whitespace-pre-wrap [&_code]:break-words" (was text-green-800 prose-code:bg-green-100)

    Navigation button (Next/Finish):
    - "w-full rounded-md bg-primary px-4 py-3 text-sm font-semibold text-white hover:bg-primary-hover focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 focus:ring-offset-background transition"
      (was bg-blue-600 hover:bg-blue-500 focus:ring-blue-500)
  </action>
  <verify>
    Run: npm run build — must pass without errors.

    Run: npm run dev, start a quiz session (requires Anthropic API key in .env.local).
    Verify in browser:
    1. ProgressIndicator: dark track, purple fill
    2. TopicBadge: purple-muted chip
    3. QuestionDisplay: dark prose text, purple coding badge, green theoretical badge, amber difficulty badge, code blocks with dark code-bg
    4. AnswerInput (theoretical): dark elevated textarea, purple submit button, ghost skip button
    5. AnswerInput (coding): Monaco editor in vs-dark theme, dark border
    6. EvaluationResult: score in appropriate token color, feedback in primary-muted card, model answer in success-muted card, purple next button
  </verify>
  <done>
    - All 5 components use design system tokens exclusively
    - Monaco editor renders in vs-dark theme
    - getScoreColor() uses text-success/text-accent/text-warning/text-error tokens
    - Quiz question display, answer submission, evaluation display, and navigation all function correctly
    - npm run build passes
    - No hardcoded bg-blue/text-gray/border-gray classes remain in these 5 files
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Checkpoint: Verify quiz flow dark mode and full quiz functionality</name>
  <files>src/pages/QuizSetup.tsx, src/components/quiz/QuestionDisplay.tsx, src/components/quiz/EvaluationResult.tsx</files>
  <action>Human visual verification of dark mode quiz flow and end-to-end quiz functionality</action>
  <verify>See how-to-verify steps below</verify>
  <done>Human types "approved" confirming dark mode quiz flow matches design system and quiz works end-to-end</done>
  <what-built>
    Quiz flow dark mode redesign:
    - src/pages/QuizSetup.tsx: dark page and form card
    - src/components/quiz/QuizSetupForm.tsx: dark checkboxes (purple active), purple submit button
    - src/pages/QuizSession.tsx: dark session page wrapper and loading states
    - src/components/quiz/QuestionDisplay.tsx: token-based badges, dark prose, code-bg code blocks
    - src/components/quiz/AnswerInput.tsx: dark textarea + Monaco vs-dark, purple submit
    - src/components/quiz/ProgressIndicator.tsx: purple progress bar on subtle track
    - src/components/quiz/EvaluationResult.tsx: token colors, primary-muted feedback, success-muted model answer
    - src/components/quiz/TopicBadge.tsx: purple-muted chip
  </what-built>
  <how-to-verify>
    Run: npm run dev

    1. Visit http://localhost:5173/quiz/setup (must be logged in)
       Expected: Dark page, dark form card, topic checkboxes with dark elevated bg, purple active state when checked, purple "Start Quiz" button

    2. Start a quiz session (select 1 topic, normal difficulty, theoretical, 5 questions)
       Expected: Quiz session page is dark, progress bar has purple fill, topic badges are purple-muted chips

    3. View a question
       Expected: Question title in foreground white, body text in muted-foreground, code blocks using code-bg (#111118), type badge (Coding=purple, Theoretical=green), difficulty badge in warning amber

    4. For a theoretical question: verify textarea is dark elevated with light placeholder
       Submit an answer — verify evaluation loads and shows:
       - Score in appropriate token color (green=success, blue=accent, yellow=warning, red=error)
       - Feedback in primary-muted card (dark purple)
       - Model answer in success-muted card (dark green)
       - Purple "Next Question" button

    5. For a coding question: verify Monaco editor shows vs-dark theme

    6. Check 3 breakpoints:
       - Mobile (375px): form fits width, quiz layout doesn't overflow
       - Tablet (768px): comfortable reading width
       - Desktop (1024px): no regressions

    7. Run Lighthouse Accessibility on /quiz/setup
       Expected: Score >= 85; purple text on primary-muted background (#7C3AED on #3B1F6A) must pass AA (4.5:1 for small text). Check focus outlines are visible on dark background.

    8. Skip a question — verify skip works and session advances normally
  </how-to-verify>
  <resume-signal>Type "approved" if quiz flow matches dark design system and all functionality works, or describe any visual or functional issues</resume-signal>
</task>

</tasks>

<verification>
- npm run build passes (no TypeScript or CSS errors)
- All 8 files use only design system token classes (no remaining bg-blue-*, text-gray-*, bg-white, bg-gray-* in quiz flow)
- QuizSetupForm topic checkboxes: dark elevated bg, purple active state
- QuestionDisplay: correct badge colors (coding=primary-muted/primary, theoretical=success-muted/success, difficulty=warning-muted/warning)
- AnswerInput: Monaco editor in vs-dark theme; textarea dark elevated with placeholder-placeholder
- EvaluationResult: getScoreColor returns text-success/text-accent/text-warning/text-error
- ProgressIndicator: bg-primary fill on bg-subtle track
- Quiz generation, submission, evaluation, and skip functionality all work end-to-end
- Responsive at 375px, 768px, 1024px breakpoints
- Lighthouse accessibility score >= 85 on /quiz/setup
</verification>

<success_criteria>
- All 8 quiz flow files exclusively use quiz-you.pen design tokens
- QuizSetupForm produces valid sessions (form validation + Supabase insert untouched)
- LLM question generation, evaluation, and skip all work without regression
- Dark mode quiz experience is visually consistent: dark backgrounds, purple accents, appropriate status colors
- Monaco editor uses vs-dark theme
- Human-verify checkpoint approved
</success_criteria>

<output>
After completion, create `.planning/phases/05-ui-redesign-with-quiz-you-pen/05-02-SUMMARY.md` with:
- Changes made to each of the 8 files
- Any token mapping decisions (e.g., which token maps to which old class)
- Monaco theme decision (vs-dark)
- Issues or edge cases discovered
- Checkpoint result
</output>
